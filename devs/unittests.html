

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Unit testing &mdash; qucat  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Writing documentation or website content" href="online_doc.html" />
    <link rel="prev" title="Commenting and docstrings" href="comments.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            qucat
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citing.html">Citing this project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/index.html">List of functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../report_a_bug.html">Report a bug</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="comments.html"> Format for docstrings and comments</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#"> How to write and run unittests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running-tests">Running tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-a-basic-test">Writing a basic test</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-a-test-for-a-gui-functionality">Writing a test for a GUI functionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-a-test-based-on-a-tutorial">Writing a test based on a tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="online_doc.html"> How to edit and build the documentation and website</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">qucat</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Contributing to QuCAT</a></li>
      <li class="breadcrumb-item active">Unit testing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/devs/unittests.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="unit-testing">
<span id="unittesting"></span><h1>Unit testing<a class="headerlink" href="#unit-testing" title="Link to this heading"></a></h1>
<p>Tests are setup using pythons default testing framework
<a class="reference external" href="https://docs.python.org/2/library/unittest.html">unittest</a>.
These tests are run each time new code is pushed to our Github repository
using <a class="reference external" href="https://docs.github.com/en/actions/">GitHub Actions</a>.
They can also be edited
and run on your local machine as explained below.</p>
<p>In these explanations, we assume you have
cloned a version of the
<a class="reference external" href="https://github.com/qucat/qucat/">qucat repository</a>
to your computer.</p>
<section id="running-tests">
<h2>Running tests<a class="headerlink" href="#running-tests" title="Link to this heading"></a></h2>
<p>Tests are located in the the <code class="docutils literal notranslate"><span class="pre">tests</span></code> directory. These can be run from the command line
after navigating to the root directory of the qucat repository with the command</p>
<p><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">unittest</span> <span class="pre">discover</span> <span class="pre">-v</span> <span class="pre">-s</span> <span class="pre">./tests</span> <span class="pre">-p</span> <span class="pre">test_*.py</span></code></p>
<p>Each test file is dedicated to a specific part of the library,
and is generally paired with a specific file of the source code,
for example the file <code class="docutils literal notranslate"><span class="pre">test/test_core.py</span></code> tests the functionalities of the
<code class="docutils literal notranslate"><span class="pre">src/test_core.py</span></code> file.</p>
<p>To run only run one of the test files, <code class="docutils literal notranslate"><span class="pre">test_core.py</span></code> for example, one can also run</p>
<p><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">tests/test_core.py</span></code></p>
<p>Executing only a single test from a file is also possible
by running for example</p>
<p><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">tests/test_core.py</span> <span class="pre">SeriesRLC.test_frequency</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some GUI tests have failed for a mysterious reason on certain
operating systems, even thought the functionality they test works
when tested manually.</p>
</div>
</section>
<section id="writing-a-basic-test">
<h2>Writing a basic test<a class="headerlink" href="#writing-a-basic-test" title="Link to this heading"></a></h2>
<p>Let us assume that a developer wishes to contribute a new module <code class="docutils literal notranslate"><span class="pre">src/new.py</span></code>
which contains a function <code class="docutils literal notranslate"><span class="pre">f</span></code> which adds two numbers</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds two numbers and returns the result.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="o">...</span>
</pre></div>
</div>
<p>One should then create a <code class="docutils literal notranslate"><span class="pre">test/test_new.py</span></code> file which test if the
function works as expected.
This is one way of doing it</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import python test framework</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># Add the ./src/ folder to the system path</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span><span class="s1">&#39;src&#39;</span><span class="p">)))</span>

<span class="c1"># Import function to be tested</span>
<span class="kn">from</span> <span class="nn">new</span> <span class="kn">import</span> <span class="n">f</span>

<span class="k">class</span> <span class="nc">TestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_f_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Check if f(1,2) is indeed equal to 3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>For more details on the unittest framework, check
<a class="reference external" href="https://docs.python.org/2/library/unittest.html">this link</a>.</p>
</section>
<section id="writing-a-test-for-a-gui-functionality">
<h2>Writing a test for a GUI functionality<a class="headerlink" href="#writing-a-test-for-a-gui-functionality" title="Link to this heading"></a></h2>
<p>Testing the GUI functionalities <em>i.e.</em> <strong>what
happens if I click here?</strong> is also possible in an automatic
way by simulating mouse motion, clicks or keystrokes events.
These test are located in <code class="docutils literal notranslate"><span class="pre">test/test_gui.py</span></code></p>
<p>Creating these tests is also done through the GUI, and we present
here a short tutorial on how to do so.</p>
<p>Let’s assume we want to test moving a resistor by clicking, dragging
then dropping.</p>
<p>The correct location to add this test is in the
<code class="docutils literal notranslate"><span class="pre">test/test_gui.py</span></code> file, with the following code</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestMovingComponentsAround</span><span class="p">(</span><span class="n">AutomaticTesting</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_moving_resistor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">launch_gui_testing</span><span class="p">(</span><span class="n">force_build</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">run_slower</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The <strong>first time</strong> we run this file,
an empty GUI will open.
<strong>Step 1:</strong> here we set the initial configuration for the
test, in this example we create and place a resistor, then close the GUI.
This circuit will be saved in the file
<code class="docutils literal notranslate"><span class="pre">tests/gui_testing_files/test_moving_resistor/initial_netlist.txt</span></code>
<strong>Step 2:</strong>  a second GUI will open in the initial configuration, and we now
perform the task we are testing.
Our actions will be recorded in the file
<code class="docutils literal notranslate"><span class="pre">tests/gui_testing_files/test_moving_resistor/events.txt</span></code>
later repeated in an automatic way when running this test. In this
example, we drag and drop the resistor to another location, then
close the GUI.
Upon closing the GUI, the final configuration of the circuit
is recorded in the file
<code class="docutils literal notranslate"><span class="pre">tests/gui_testing_files/test_moving_resistor/final_netlist</span></code></p>
<p>The <strong>subsequent times</strong> we run this test no human intervention
is necessary.
A GUI will be opened in the initial configuration,
a sequence of events will be triggered,
and the final configuration of the circuit will be stored in the file
<code class="docutils literal notranslate"><span class="pre">tests/gui_testing_files/test_moving_resistor/final_after_events_netlist.txt</span></code>
and compared to the configuration created manually
<code class="docutils literal notranslate"><span class="pre">tests/gui_testing_files/test_moving_resistor/final_netlist</span></code>.
If the files are identical, the test passes.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">AutomaticTesting.launch_gui_testing</span></code> which implements
these functionalities takes two arguments.
By setting <code class="docutils literal notranslate"><span class="pre">force_build</span> <span class="pre">=</span> <span class="pre">True</span></code>, the test is run as if for the first
time.
By setting <code class="docutils literal notranslate"><span class="pre">run_slower</span> <span class="pre">=</span> <span class="pre">True</span></code>, the test is run very slowly
so that one can observe what the automatically generated sequence
of events is doing to the GUI.
This enables easy debugging of the test.</p>
</section>
<section id="writing-a-test-based-on-a-tutorial">
<h2>Writing a test based on a tutorial<a class="headerlink" href="#writing-a-test-based-on-a-tutorial" title="Link to this heading"></a></h2>
<p>All tutorials featured on the website are
jupyter notebooks
located in the folder <code class="docutils literal notranslate"><span class="pre">docs_src/source/tutorials</span></code>
and are
also run as tests.
These tests are located in <code class="docutils literal notranslate"><span class="pre">test/test_tutorials.py</span></code>.</p>
<p>If one adds a new notebook, for example <code class="docutils literal notranslate"><span class="pre">new_tutorial.ipynb</span></code>
in the tutorials folder, one can test it by adding the following code
to the <code class="docutils literal notranslate"><span class="pre">test/test_tutorials.py</span></code> script</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestNewTutorial</span><span class="p">(</span><span class="n">TestTutorials</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_if_it_runs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Runs the notebook new_tutorial.ipynb.</span>
<span class="sd">            If an error is encountered the test fails</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_tutorial</span><span class="p">(</span><span class="s1">&#39;new_tutorial.ipynb&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_if_it_produces_the_right_answer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Runs the notebook new_tutorial.ipynb</span>
<span class="sd">            and stores all the variables defined in the notebook</span>
<span class="sd">            as a dictionary called variables.</span>
<span class="sd">            We then check if the variable called</span>
<span class="sd">            &quot;name_of_variable&quot; is equal to 10, </span>
<span class="sd">            the test will fail if it isnt.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_tutorial</span><span class="p">(</span><span class="s1">&#39;new_tutorial.ipynb&#39;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;name_of_variable&#39;</span><span class="p">]</span>
        <span class="n">expected_value_of_variable</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">expected_value_of_variable</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="comments.html" class="btn btn-neutral float-left" title="Commenting and docstrings" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="online_doc.html" class="btn btn-neutral float-right" title="Writing documentation or website content" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Mario Gely.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>